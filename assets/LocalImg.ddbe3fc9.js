import{_ as U,d as j,r as n,I as z,o as u,h as r,e as s,t as N,f as I,b as P,F as f,j as B,g as H,ag as g,af as w,ah as O,a3 as J,K as A,p as V}from"./index.af0cd0c6.js";import{d as K}from"./images.296340bd.js";const M={class:"local-img-wrapper"},W={class:"operation-wrapper"},q={class:"img-wrapper"},G=["src"],Q={class:"mask"},X=["onClick"],Y=["onClick"],Z=j({__name:"LocalImg",setup(ee){const v=n(!1),D=()=>{v.value=!0,y()},b=n([]),_=n([]),m=n(1),k=18,h=n(!0),F=n(),C=n(!1),{t:c}=z(),y=async()=>{m.value=1,_.value=[],h.value=!0,b.value=(await g.keys()).reverse(),E()},E=async()=>{const a=b.value.slice((m.value-1)*k,m.value*k);if(a.length){const t=await Promise.all(a.map(async l=>{const o=await g.getItem(l);return{key:l,value:o}}));_.value.push(...t)}else h.value=!1};let p;const R=a=>{if(!h.value)return;const t=a.target;p&&(clearTimeout(p),p=null),p=setTimeout(()=>{const{scrollTop:l,scrollHeight:o,clientHeight:e}=t,i=o-l-e<=30;i&&(console.log("isReachBottom",i),m.value++,E())},200)},$=async a=>{const t=await w.getItem(a.key);if(t){const l=O(t),o=URL.createObjectURL(l);window.open(o)}},x=async a=>{window.confirm(c("\u786E\u5B9A\u8981\u5220\u9664\u6240\u9009\u9879?"))&&a.key&&(await w.removeItem(a.key),await g.removeItem(a.key),y())},S=()=>{F.value.click()},T=async a=>{C.value=!0;try{const t=a.target.files,o=(await Promise.all([...t].map(async e=>{const i=await new Promise(L=>{const d=new FileReader;d.readAsDataURL(e),d.onload=()=>{L(d.result)},d.onerror=()=>{L("")}});return{thumbImg:await K(e,200),realImg:i}}))).filter(e=>e.thumbImg&&e.realImg).map(e=>({id:`${+new Date},${J()}`,realImg:e.realImg,thumbImg:e.thumbImg}));console.log("imgList",o),await Promise.all(o.map(async e=>{await w.setItem(e.id,e.realImg),await g.setItem(e.id,e.thumbImg)})),A({title:c("\u6210\u529F"),type:"success",message:c("\u4E0A\u4F20\u6210\u529F")}),y()}catch{A({title:c("\u9519\u8BEF"),type:"error",message:c("\u4E0A\u4F20\u51FA\u9519")})}finally{C.value=!1}};return(a,t)=>{const l=V("Icon"),o=V("easy-dialog");return u(),r(f,null,[s("button",{type:"button",class:"btn btn-primary btn-small",style:{margin:"0"},onClick:D},N(a.$t("\u7BA1\u7406\u672C\u5730\u56FE\u7247\u5E93")),1),I(o,{modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=e=>v.value=e),title:a.$t("\u672C\u5730\u56FE\u7247\u5E93"),width:"min(760px, 94vw)",height:"min(480px, 80vh)"},{default:P(()=>[s("div",M,[s("div",W,[s("button",{type:"button",class:"btn btn-primary",onClick:S},"\u4E0A\u4F20\u56FE\u7247"),s("input",{type:"file",style:{display:"none"},ref_key:"inputFile",ref:F,accept:"image/*",multiple:"",onChange:T},null,544)]),s("div",{class:"content-wrapper",onScroll:R},[(u(!0),r(f,null,B(_.value,e=>(u(),r("div",{class:"item",key:e},[s("div",q,[e.value?(u(),r("img",{key:0,src:e.value,loading:"lazy"},null,8,G)):H("",!0),s("div",Q,[s("div",{class:"icon-jump",onClick:i=>$(e)},[I(l,{name:"jump",size:"18"})],8,X),s("div",{class:"icon-delete",onClick:i=>x(e)},[I(l,{name:"delete",size:"18"})],8,Y)])])]))),128)),(u(),r(f,null,B(4,e=>s("div",{class:"item-fake",key:e})),64))],32)])]),_:1},8,["modelValue","title"])],64)}}});var le=U(Z,[["__scopeId","data-v-347a585a"]]);export{le as default};
