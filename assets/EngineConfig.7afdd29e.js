var Y=Object.defineProperty;var U=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var O=(e,n,d)=>n in e?Y(e,n,{enumerable:!0,configurable:!0,writable:!0,value:d}):e[n]=d,L=(e,n)=>{for(var d in n||(n={}))z.call(n,d)&&O(e,d,n[d]);if(U)for(var d of U(n))G.call(n,d)&&O(e,d,n[d]);return e};import{D as W}from"./vuedraggable.umd.2a8056d6.js";import{g as S}from"./images.a3f92956.js";import{_ as H,T as K,u as Q,d as Z,i as x}from"./index.68ad8ce7.js";import{h as ee,r as D,o as oe,N as ne,i as te,e as s,g as a,s as l,t as r,D as p,G as ae,F as P,n as ue,aa as $,p as ie,f as se,m as h,d as i,E as _,v as le,x as j,L as w}from"./vendor.66f145fe.js";const re=[{label:"API\u83B7\u53D6",value:"api"},{label:"\u6587\u5B57\u56FE\u6807",value:"text"},{label:"\u7F51\u7EDC\u56FE\u7247",value:"network"}],de=ee({name:"EngineConfig",components:{Draggable:W,Tips:K},props:{engineList:{type:Array,required:!0},backupEngineList:{type:Array,required:!0}},emits:["update"],setup(e,{emit:n}){const d=D(!1),B=D(!1),m=D([]),k=D([]),y=D(""),f=D();oe(()=>{m.value=JSON.parse(JSON.stringify(e.engineList)),k.value=JSON.parse(JSON.stringify(e.backupEngineList))});const E=g=>{const{oldIndex:c}=g,{iconType:u}=m.value[c];u!=="local"&&(B.value=!0)},T=async()=>{await ue(),B.value=!1},A=g=>{const{originalEvent:c}=g;let u;if(c.type==="touchend"){const{clientX:F,clientY:v}=c.changedTouches[0];u=document.elementFromPoint(F,v)}else{const{clientX:F,clientY:v}=c;u=document.elementFromPoint(F,v)}if((u==null?void 0:u.className)==="delete-area"&&window.confirm("\u662F\u5426\u5220\u9664\u8BE5\u81EA\u5B9A\u4E49\u5F15\u64CE")){const{newIndex:F}=g;m.value.splice(F,1)}n("update",{engineList:m.value,backupEngineList:k.value})},t=ne({formData:{_id:"",name:"",link:"",iconType:"api",iconPath:""},formRules:{name:[{required:!0,message:"\u8BF7\u8F93\u5165\u5F15\u64CE\u540D\u79F0",trigger:"blur"}],link:[{required:!0,message:"\u8BF7\u8F93\u5165\u5F15\u64CE\u5730\u5740",trigger:"blur"}],iconType:[{required:!0,message:"\u8BF7\u9009\u62E9\u56FE\u6807\u7C7B\u578B",trigger:"change"}],iconPath:[{validator:V,trigger:"blur"}]}});function V(g,c,u){t.formData.iconType==="network"&&!c?u(new Error("\u8BF7\u8F93\u5165\u56FE\u6807\u5730\u5740")):u()}const C=D(),o=te(()=>t.formData.iconType==="api"&&t.formData.link||t.formData.iconType==="network"&&t.formData.iconPath||t.formData.iconType==="text"&&t.formData.name),I=()=>{t.formData={_id:"",name:"",link:"",iconType:"api",iconPath:""},f.value.open()},N=()=>{C.value.resetFields(),t.formData={_id:"",name:"",link:"",iconType:"api",iconPath:""},f.value.close()},q=()=>{C.value.validate(async g=>{if(g){if(t.formData.iconType==="api"&&y.value)try{const u=await(await fetch(`${Z}/api/icon?url=${encodeURIComponent(t.formData.link)}&type=link`)).text();u&&(t.formData.iconType="network",t.formData.iconPath=u)}catch{}if(t.formData._id){const c=m.value.findIndex(u=>u._id===t.formData._id);~c&&(m.value[c]=L({},$(t.formData)))}else t.formData._id=x(),m.value.push(L({},$(t.formData)));n("update",{engineList:m.value,backupEngineList:k.value}),N()}else return!1})},R=()=>{y.value=S(t.formData.link)},J=g=>{const{_id:c,name:u,link:F,iconType:v,iconPath:X}=g;v!=="local"&&(t.formData={_id:c,name:u,link:F,iconType:v,iconPath:X},f.value.open())},M=Q(!0);return{engineDialog:f,dragDisabled:d,showDeleteArea:B,cloneEngineList:m,cloneBackupEngineList:k,handleDragChoose:E,handleDragUnchoose:T,handleDragEnd:A,handleAddNewEngine:I,handleEditEngine:J,iconTypeList:re,state:t,form:C,showIconPreview:o,close:N,submit:q,getTargetIcon:S,tempIconLink:y,handleLinkInputBlur:R,dialogOptions:M}}}),b=e=>(ie("data-v-9152f612"),e=e(),se(),e),ce={class:"engine-config",style:{"margin-left":"-100px","padding-bottom":"10px","border-bottom":"1px solid #ccc"}},pe=b(()=>a("div",{class:"warning"},"\u62D6\u62FD\u4E0B\u65B9\u56FE\u6807\u53EF\u66F4\u6362\u5F15\u64CE\u987A\u5E8F\uFF0C\u4E5F\u53EF\u6DFB\u52A0\u81EA\u5B9A\u4E49\u5F15\u64CE\uFF0C\u5BF9\u4E8E\u81EA\u5B9A\u4E49\u5F15\u64CE\u53CC\u51FB\u56FE\u6807\u91CD\u65B0\u7F16\u8F91",-1)),me={class:"content"},ge=b(()=>a("div",{class:"text s-title"},"\u5F53\u524D\u5F15\u64CE\u7EC4",-1)),fe={class:"current-engine-wrapper"},he=["onDblclick","title"],Ee=["src"],Fe=["src"],De={key:2,class:"no-icon"},ye={class:"text"},ve=b(()=>a("div",{class:"text s-title"},"\u5907\u7528\u5F15\u64CE\u7EC4",-1)),_e={class:"backup-engine-wrapper"},ke={class:"engine-list-item"},Ce=["src"],be=["src"],Be={key:2,class:"no-icon"},we={class:"text"},Te={key:0,class:"delete-area"},Ae={class:"form-control"},Ve=b(()=>a("div",{class:"tips"},[w("\u9ED8\u8BA4\u641C\u7D22\u5185\u5BB9\u4F1A\u88AB\u62FC\u63A5\u5230\u5F15\u64CE\u5730\u5740\u672B\u5C3E, \u4E5F\u53EF\u4EE5\u4F7F\u7528 "),a("b",null,"[0]"),w(" \u5BF9\u539F\u5730\u5740\u641C\u7D22\u5173\u952E\u8BCD\u8FDB\u884C\u5360\u4F4D")],-1)),Le=b(()=>a("div",{class:"tips"},[w("\u4F8B\u5982: "),a("b",null,"https://juejin.im/search?query=[0]&type=all")],-1)),Pe={class:"icon-img-preview-box"},Ie=["src"],Ne=["src"],Ue={key:2,class:"no-icon"},Oe={key:1,class:"icon-img-preview"},Se={class:"footer",style:{"text-align":"right",padding:"12px"}};function $e(e,n,d,B,m,k){const y=h("Draggable"),f=h("el-input"),E=h("el-form-item"),T=h("Tips"),A=h("el-radio"),t=h("el-radio-group"),V=h("el-form"),C=h("animation-dialog");return i(),s(P,null,[a("div",ce,[pe,a("div",me,[a("button",{type:"button",class:"btn btn-primary btn-small btn-add",onClick:n[0]||(n[0]=(...o)=>e.handleAddNewEngine&&e.handleAddNewEngine(...o))},"\u6DFB\u52A0"),ge,a("div",fe,[l(y,{modelValue:e.cloneEngineList,"onUpdate:modelValue":n[1]||(n[1]=o=>e.cloneEngineList=o),class:"now-engine-list engine-list","item-key":"name",group:"people",onChoose:e.handleDragChoose,onUnchoose:e.handleDragUnchoose,onEnd:e.handleDragEnd},{item:r(({element:o})=>[a("div",{class:"engine-list-item",onDblclick:I=>e.handleEditEngine(o),title:o.iconType!=="local"?"\u53CC\u51FB\u91CD\u65B0\u7F16\u8F91":""},[o.iconType==="local"||o.iconType==="network"?(i(),s("img",{key:0,src:o.iconPath,alt:"icon",width:"24",height:"24"},null,8,Ee)):p("",!0),o.iconType==="api"?(i(),s("img",{key:1,src:e.getTargetIcon(o.link),alt:"icon",width:"24",height:"24"},null,8,Fe)):p("",!0),o.iconType==="text"?(i(),s("div",De,_(o.name.slice(0,1)),1)):p("",!0),a("div",ye,_(o.name),1)],40,he)]),_:1},8,["modelValue","onChoose","onUnchoose","onEnd"])]),ve,a("div",_e,[l(y,{modelValue:e.cloneBackupEngineList,"onUpdate:modelValue":n[2]||(n[2]=o=>e.cloneBackupEngineList=o),"item-key":"name",group:"people",class:"backupEngineList engine-list",onEnd:e.handleDragEnd},{item:r(({element:o})=>[a("div",ke,[o.iconType==="local"||o.iconType==="network"?(i(),s("img",{key:0,src:o.iconPath,alt:"icon",width:"24",height:"24"},null,8,Ce)):p("",!0),o.iconType==="api"?(i(),s("img",{key:1,src:e.getTargetIcon(o.link),alt:"icon",width:"24",height:"24"},null,8,be)):p("",!0),o.iconType==="text"?(i(),s("div",Be,_(o.name.slice(0,1)),1)):p("",!0),a("div",we,_(o.name),1)])]),_:1},8,["modelValue","onEnd"]),e.showDeleteArea?(i(),s("div",Te,"\u62D6\u62FD\u81F3\u6B64\u5904\u5220\u9664")):p("",!0)])])]),l(C,ae({ref:"engineDialog",animationMode:"",title:`${e.state.formData._id?"\u7F16\u8F91":"\u6DFB\u52A0"}\u81EA\u5B9A\u4E49\u5F15\u64CE`,width:"min(380px, 90vw)",height:"min(460px, 80vh)",customClass:"add-engine-dialog",closeOnClickOutside:!1,listenWindowSizeChange:"",appendToBody:""},e.dialogOptions),{footer:r(()=>[a("div",Se,[a("button",{type:"button",class:"btn",onClick:n[8]||(n[8]=(...o)=>e.close&&e.close(...o))},"\u53D6\u6D88"),a("button",{type:"button",class:"btn btn-primary",onClick:n[9]||(n[9]=(...o)=>e.submit&&e.submit(...o))},"\u786E\u8BA4")])]),default:r(()=>[l(V,{ref:"form","label-width":"80px",model:e.state.formData,rules:e.state.formRules},{default:r(()=>[l(E,{label:"\u5F15\u64CE\u540D\u79F0",prop:"name"},{default:r(()=>[l(f,{modelValue:e.state.formData.name,"onUpdate:modelValue":n[3]||(n[3]=o=>e.state.formData.name=o),placeholder:"\u8BF7\u8F93\u5165\u5F15\u64CE\u540D\u79F0"},null,8,["modelValue"])]),_:1}),l(E,{label:"\u5F15\u64CE\u5730\u5740",prop:"link"},{default:r(()=>[a("div",Ae,[l(f,{modelValue:e.state.formData.link,"onUpdate:modelValue":n[4]||(n[4]=o=>e.state.formData.link=o),placeholder:"\u8BF7\u8F93\u5165\u5F15\u64CE\u5730\u5740",onBlur:e.handleLinkInputBlur},null,8,["modelValue","onBlur"]),l(T,null,{default:r(()=>[Ve,Le]),_:1})])]),_:1}),l(E,{label:"\u5F15\u64CE\u56FE\u6807",prop:"iconType"},{default:r(()=>[l(t,{modelValue:e.state.formData.iconType,"onUpdate:modelValue":n[5]||(n[5]=o=>e.state.formData.iconType=o)},{default:r(()=>[(i(!0),s(P,null,le(e.iconTypeList,o=>(i(),j(A,{label:o.value,key:o.value},{default:r(()=>[w(_(o.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),e.state.formData.iconType==="network"?(i(),j(E,{key:0,label:"\u56FE\u6807\u5730\u5740",prop:"iconPath"},{default:r(()=>[l(t,{modelValue:e.state.formData.iconType,"onUpdate:modelValue":n[7]||(n[7]=o=>e.state.formData.iconType=o)},{default:r(()=>[l(f,{modelValue:e.state.formData.iconPath,"onUpdate:modelValue":n[6]||(n[6]=o=>e.state.formData.iconPath=o),placeholder:"\u8BF7\u8F93\u5165\u56FE\u6807\u5730\u5740"},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1})):p("",!0),l(E,{label:"\u56FE\u6807\u9884\u89C8"},{default:r(()=>[a("div",Pe,[e.showIconPreview?(i(),s(P,{key:0},[e.state.formData.iconType==="network"?(i(),s("img",{key:0,src:e.state.formData.iconPath,alt:"icon",width:"24",height:"24"},null,8,Ie)):p("",!0),e.state.formData.iconType==="api"?(i(),s("img",{key:1,src:e.tempIconLink,alt:"icon",width:"24",height:"24"},null,8,Ne)):p("",!0),e.state.formData.iconType==="text"?(i(),s("div",Ue,_(e.state.formData.name.slice(0,1)),1)):p("",!0)],64)):(i(),s("div",Oe))])]),_:1})]),_:1},8,["model","rules"])]),_:1},16,["title"])],64)}var Xe=H(de,[["render",$e],["__scopeId","data-v-9152f612"]]);export{Xe as default};
