var X=Object.defineProperty;var N=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var D=(e,n,i)=>n in e?X(e,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[n]=i,F=(e,n)=>{for(var i in n||(n={}))Y.call(n,i)&&D(e,i,n[i]);if(N)for(var i of N(n))Z.call(n,i)&&D(e,i,n[i]);return e};import{h as _,k as x,r as p,i as S,o as ee,b as ne,e as l,g as u,ad as C,D as d,E as k,s as v,t as E,ab as I,y as T,ae as te,A as $,m as oe,d as r,af as O,F as J,v as U,z as ie,L as ae,p as se,f as le}from"./vendor.66f145fe.js";import{_ as re,d as ce,m as ue}from"./index.52a495f8.js";import{g as de}from"./images.94ba6faa.js";const me=_({name:"Search",props:{componentSetting:{type:Object,required:!0},element:{type:Object,required:!0},isAction:{type:Boolean,default:!1}},setup(e){const n=x(),i=p(0),f=p(!1),c=p(""),s=p([]),a=p(-1),o=p(!1),g=p(),y=S(()=>e.componentSetting.engineList[i.value]||e.componentSetting.engineList[0]);let w;const V=t=>{i.value=t,f.value=!1},b=()=>{e.componentSetting.rememberHistory&&q(c.value);let t=y.value.link;/\[0\]/.test(t)?t=t.replace(/\[0\]/,encodeURIComponent(c.value)):t=t+encodeURIComponent(c.value),e.componentSetting.jumpType===2?window.location.href=t:window.open(t),c.value="",s.value=[],g.value.blur()},j=t=>{[9,13,38,40].includes(t.keyCode)?(t.keyCode===9&&(t.shiftKey?(i.value=i.value<=0?e.componentSetting.engineList.length-1:--i.value,t.preventDefault()):(i.value=i.value>=e.componentSetting.engineList.length-1?0:++i.value,t.preventDefault())),t.keyCode===13&&b(),t.keyCode===38&&(a.value=a.value<=0&&s.value.length>0?s.value.length-1:a.value-1,c.value=s.value[a.value]),t.keyCode===40&&(a.value=a.value<s.value.length-1&&s.value.length>0?a.value+1:0,c.value=s.value[a.value])):(w&&window.clearTimeout(w),w=window.setTimeout(()=>{A()},400))},L=S(()=>e.componentSetting.focusBgAnimation&&n.state.global.background.includes("url")),M=()=>{A(),e.componentSetting.showTabTips&&(!e.componentSetting.rememberHistory||e.componentSetting.rememberHistoryList.length===0)&&(o.value=!0),L.value&&n.dispatch("updateState",{key:"showBackgroundEffect",value:!0})},R=()=>{setTimeout(()=>{o.value=!1},200),s.value=[],L.value&&n.dispatch("updateState",{key:"showBackgroundEffect",value:!1})},z=()=>{o.value=!1;const t=JSON.parse(JSON.stringify(e.element));e.isAction?(t.actionSetting.actionClickValue.componentSetting.showTabTips=!1,n.dispatch("updateActionElement",t)):t.componentSetting.showTabTips=!1,n.dispatch("editComponent",t)},P=()=>{c.value=""},W=t=>{s.value=[],a.value=-1,c.value=t,setTimeout(()=>{b()},200)};async function A(){if(!c.value){e.componentSetting.rememberHistory?s.value=e.componentSetting.rememberHistoryList||[]:s.value=[],a.value=-1;return}if(!!e.componentSetting.keywordLink)try{const t=await fetch(`${ce}/getAutomatedKeywords?s=${c.value}`),{errCode:m,data:h}=await t.json();if(m===200)o.value=!1,c.value&&(s.value=h);else throw new Error("403")}catch{s.value=[],a.value=-1}}function q(t){const m=JSON.parse(JSON.stringify(e.element)),h=m.componentSetting.rememberHistoryList||[];~h.indexOf(t)||(h.unshift(t),h.length>10&&(h.length=10),e.isAction?(m.actionSetting.actionClickValue.componentSetting.rememberHistoryList=h,n.dispatch("updateActionElement",m)):m.componentSetting.rememberHistoryList=h,n.dispatch("editComponent",m))}function G(){const t=JSON.parse(JSON.stringify(e.element));e.isAction?(t.actionSetting.actionClickValue.componentSetting.rememberHistoryList=[],n.dispatch("updateActionElement",t)):t.componentSetting.rememberHistoryList=[],n.dispatch("editComponent",t)}const B=p();function H(t){f.value&&!B.value.contains(t.target)&&(f.value=!1)}ee(()=>{o.value=e.element.showTabTips,document.addEventListener("click",H)}),ne(()=>{document.removeEventListener("click",H)});const Q=S(()=>ue(e.componentSetting.position)),K=S(()=>n.state.isLock);return{activeEngine:i,showEngine:f,searchKey:c,linkSearchArr:s,linkSearchArrActive:a,showTabTips:o,activeEngineItem:y,handleChangeEngine:V,handleInputKeyDown:j,handleInputFocus:M,handleInputBlur:R,hanldeNoShowMore:z,handleClear:P,handleLinkSearchJump:W,handleSearchBtnClick:b,searchInput:g,engineSelecotr:B,positionCSS:Q,getTargetIcon:de,clearHistory:G,contextmenu:t=>{K.value&&t.stopPropagation()},isLock:K}}}),he=e=>(se("data-v-ef7fc464"),e=e(),le(),e),pe=["src"],ge=["src"],ve={key:2,class:"no-icon"},fe={class:"engine-selecotr",ref:"engineSelecotr"},ye=["onClick"],Se=["src"],ke=["src"],we={key:2,class:"no-icon"},be={class:"text"},Ce={class:"search-input-box-wrapper"},Ee={key:0,class:"link-search-wrapper"},Ie=["onClick"],Te={key:0,class:"clear-history"},Le=ae(" \u6E05\u7A7A\u5386\u53F2\u8BB0\u5F55 "),Ae={class:"tab-tooltips"},Be=he(()=>u("div",{class:"main"},"\u6309Tab\u952E\u53EF\u5FEB\u901F\u5207\u6362\u641C\u7D22\u5F15\u64CE",-1));function He(e,n,i,f,c,s){const a=oe("Icon");return r(),l("div",{class:"wrapper",style:$(F({padding:e.componentSetting.padding+"px"},e.positionCSS))},[u("div",{class:"search-wrapper-box",style:$({boxShadow:e.componentSetting.boxShadow,borderRadius:`${e.componentSetting.boxRadius||4}px`,padding:`0 ${(e.componentSetting.boxRadius||4)/4}px`,background:e.componentSetting.boxBackground,maxWidth:`${e.componentSetting.maxWidth||600}px`,pointerEvents:e.isLock?"all":"none"}),onContextmenu:n[9]||(n[9]=(...o)=>e.contextmenu&&e.contextmenu(...o))},[u("div",{class:"search-engine-box",onClick:n[0]||(n[0]=C(o=>e.showEngine=!e.showEngine,["stop"]))},[e.activeEngineItem.iconType==="local"||e.activeEngineItem.iconType==="network"?(r(),l("img",{key:0,src:e.activeEngineItem.iconPath,alt:"icon",width:"24",height:"24"},null,8,pe)):d("",!0),e.activeEngineItem.iconType==="api"?(r(),l("img",{key:1,src:e.getTargetIcon(e.activeEngineItem.link),alt:"icon",width:"24",height:"24"},null,8,ge)):d("",!0),e.activeEngineItem.iconType==="text"?(r(),l("div",ve,k(e.activeEngineItem.name.slice(0,1)),1)):d("",!0)]),v(I,{name:"fadeInUp"},{default:E(()=>[T(u("div",fe,[(r(!0),l(J,null,U(e.componentSetting.engineList,(o,g)=>(r(),l("div",{class:"engine-list-item",key:g,onClick:y=>e.handleChangeEngine(g)},[o.iconType==="local"||o.iconType==="network"?(r(),l("img",{key:0,src:o.iconPath,alt:"icon",width:"24",height:"24"},null,8,Se)):d("",!0),o.iconType==="api"?(r(),l("img",{key:1,src:e.getTargetIcon(o.link),alt:"icon",width:"24",height:"24"},null,8,ke)):d("",!0),o.iconType==="text"?(r(),l("div",we,k(o.name.slice(0,1)),1)):d("",!0),u("div",be,k(o.name),1)],8,ye))),128))],512),[[O,e.showEngine]])]),_:1}),u("div",Ce,[T(u("input",{class:"search-input-box",ref:"searchInput","onUpdate:modelValue":n[1]||(n[1]=o=>e.searchKey=o),onKeydown:n[2]||(n[2]=C((...o)=>e.handleInputKeyDown&&e.handleInputKeyDown(...o),["stop"])),onFocus:n[3]||(n[3]=(...o)=>e.handleInputFocus&&e.handleInputFocus(...o)),onBlur:n[4]||(n[4]=(...o)=>e.handleInputBlur&&e.handleInputBlur(...o)),tabindex:"1"},null,544),[[te,e.searchKey]]),e.searchKey?(r(),l("div",{key:0,class:"clear-btn",onClick:n[5]||(n[5]=(...o)=>e.handleClear&&e.handleClear(...o))},[v(a,{name:"close"})])):d("",!0),v(I,{name:"fadeInUp"},{default:E(()=>[e.linkSearchArr.length>0?(r(),l("div",Ee,[(r(!0),l(J,null,U(e.linkSearchArr,(o,g)=>(r(),l("div",{class:ie(["link-search-item",{active:e.linkSearchArrActive===g}]),key:o,onClick:y=>e.handleLinkSearchJump(o)},k(o),11,Ie))),128)),!e.searchKey&&e.componentSetting.rememberHistory?(r(),l("div",Te,[u("div",{class:"clear-history-btn",onClick:n[6]||(n[6]=(...o)=>e.clearHistory&&e.clearHistory(...o))},[v(a,{name:"delete",size:"1em",style:{"margin-right":"2px"}}),Le])])):d("",!0)])):d("",!0)]),_:1})]),u("div",{class:"search-btn",onClick:n[7]||(n[7]=(...o)=>e.handleSearchBtnClick&&e.handleSearchBtnClick(...o))},[v(a,{name:"search",fill:"#484848"})]),v(I,{name:"fadeInUp"},{default:E(()=>[T(u("div",Ae,[Be,u("div",{class:"no-more",onClick:n[8]||(n[8]=C((...o)=>e.hanldeNoShowMore&&e.hanldeNoShowMore(...o),["stop"]))},"\u4E0D\u518D\u63D0\u793A")],512),[[O,e.showTabTips]])]),_:1})],36)],4)}var Je=re(me,[["render",He],["__scopeId","data-v-ef7fc464"]]);export{Je as default};
