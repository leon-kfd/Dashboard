import{_ as Y,d as ee,u as ne,G as O,H as te,I as oe,a as ie,r as B,x as le,y as ae,b as m,o as r,i as g,f as o,F as Z,k as H,A as se,C as k,t as y,L as R,h as v,l as A,g as u,e as c,N as de,P as ue,Q as re,c as ce,p as pe,s as ge,v as ye}from"./index.8aa178c7.js";import{a as b,b as fe}from"./images.130eb327.js";const F={tab:{span:1},Q:{keyCode:81},W:{keyCode:87},E:{keyCode:69},R:{keyCode:82},T:{keyCode:84},Y:{keyCode:89},U:{keyCode:85},I:{keyCode:73},O:{keyCode:79},P:{keyCode:80},brackets:{span:1},caps:{span:2},A:{keyCode:65},S:{keyCode:83},D:{keyCode:68},F:{keyCode:70},G:{keyCode:71},H:{keyCode:72},J:{keyCode:74},K:{keyCode:75},L:{keyCode:76},semi:{span:2},shift:{span:3},Z:{keyCode:90},X:{keyCode:88},C:{keyCode:67},V:{keyCode:86},B:{keyCode:66},N:{keyCode:78},M:{keyCode:77}};const x=a=>(ge("data-v-1c60684c"),a=a(),ye(),a),me=["onClick"],ke={class:"keys"},ve={class:"keys-name"},Ce=["onClick"],Ie=x(()=>o("svg",{viewBox:"0 0 24 24",width:"12",height:"12"},[o("path",{d:"M4.5 10.5C3.675 10.5 3 11.175 3 12C3 12.825 3.675 13.5 4.5 13.5C5.325 13.5 6 12.825 6 12C6 11.175 5.325 10.5 4.5 10.5ZM19.5 10.5C18.675 10.5 18 11.175 18 12C18 12.825 18.675 13.5 19.5 13.5C20.325 13.5 21 12.825 21 12C21 11.175 20.325 10.5 19.5 10.5ZM12 10.5C11.175 10.5 10.5 11.175 10.5 12C10.5 12.825 11.175 13.5 12 13.5C12.825 13.5 13.5 12.825 13.5 12C13.5 11.175 12.825 10.5 12 10.5Z"})],-1)),he=[Ie],be={key:1,class:"plus-box"},_e=x(()=>o("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[o("path",{d:"M11 11V5H13V11H19V13H13V19H11V13H5V11H11Z"})],-1)),Se=[_e],we={key:2,class:"icon-box"},Ve=["src","onError"],Ee={class:"no-icon",style:{visibility:"hidden"}},Be={key:3,class:"mark-text"},Ae=x(()=>o("div",{class:"keys"},null,-1)),Fe=[Ae],xe={class:"editing-key"},Le={class:"icon-img-preview-box"},Te=["src"],$e={class:"footer",style:{"text-align":"right",padding:"12px"}},De=["disabled"],Me=["loading"],Ke=ee({__name:"index",props:{componentSetting:{type:Object,required:!0},element:{type:Object,required:!0},isAction:{type:Boolean,default:!1}},setup(a){const f=a,_=ne(),l=O(()=>f.componentSetting.userSettingKeyMap||{}),q=O(()=>te(f.componentSetting.position)),{t:L}=oe(),z=[{label:"API\u83B7\u53D6",value:"api"},{label:"\u7F51\u7EDC\u56FE\u7247",value:"network"}],e=ie({editingActive:!1,editingInfo:{key:"",url:"",remark:"",iconType:"api",iconLink:""}}),C=B(""),T=t=>{if(!f.componentSetting.useKeyboardEvent||!_.isLock||document.querySelector("input:focus")||document.querySelector("textarea:focus")||document.querySelector(".ProseMirror-focused")||document.querySelector(".action-popover"))return;const n=t.keyCode,d=Object.keys(F).find(p=>F[p].keyCode===n);d&&l.value[d]&&U(l.value[d].url)};le(()=>{document.addEventListener("keydown",T)}),ae(()=>{document.removeEventListener("keydown",T)});const I=B(!1),J=(t,n)=>{n&&l.value[n]?U(l.value[n].url):$(t,n)},S=()=>{e.editingInfo.key="",e.editingInfo.url="",e.editingInfo.remark="",e.editingInfo.iconType="api",e.editingInfo.iconLink="",e.editingActive=!1},$=(t,n)=>{I.value=!0,e.editingInfo.key=n;const{url:d,remark:p,iconType:V,iconLink:E}=l.value[n]||{};e.editingInfo.url=d,e.editingInfo.remark=p,e.editingInfo.iconType=V||"api",e.editingInfo.iconLink=E,K(),setTimeout(()=>{e.editingActive=!0},200)},P=()=>{if(e.editingInfo.url&&e.editingInfo.remark&&confirm(L("\u786E\u5B9A\u6E05\u9664\u8BE5\u6309\u952E\u7ED1\u5B9A\u7684\u7F51\u9875\u5417?"))){e.editingInfo.url="",e.editingInfo.remark="";const t=A(l);delete t[e.editingInfo.key],N(t),S(),I.value=!1}},D=()=>{e.editingInfo.url&&e.editingInfo.iconType==="api"&&(C.value=b(e.editingInfo.url))},M=()=>{e.editingInfo.url&&e.editingInfo.iconType==="network"&&(C.value=e.editingInfo.iconLink)},K=()=>{C.value="",D(),M()},w=B(!1),j=async()=>{if(!(!e.editingInfo.url||!e.editingInfo.remark))if(/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/.test(e.editingInfo.url)){/https?:\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/.test(e.editingInfo.url)||(e.editingInfo.url="https://"+e.editingInfo.url),w.value=!0;let t="";if(e.editingInfo.iconType==="network")t=e.editingInfo.iconLink;else{try{t=await fe(b(e.editingInfo.url))}catch{t=b(e.editingInfo.url)}e.editingInfo.iconType="api"}const n=JSON.parse(JSON.stringify(l.value));n[e.editingInfo.key]={url:e.editingInfo.url,remark:e.editingInfo.remark,icon:t,iconType:e.editingInfo.iconType,iconLink:e.editingInfo.iconLink},N(n),W(e.editingInfo.key),setTimeout(()=>{S(),w.value=!1,I.value=!1},400)}else window.alert(L("URL\u5730\u5740\u4E0D\u6B63\u786E"))},G=(t,n)=>{const d=t.currentTarget;d.classList.add(`has-error-${n}`),d.style.visibility="hidden",d.nextElementSibling.style.visibility="inherit"},W=t=>{const n=document.querySelector(`.material-collection img.has-error-${t}`);n&&(n.classList.remove(`has-error-${t}`),n.style.visibility="visible",n.nextElementSibling.style.visibility="hidden")},N=t=>{const n=JSON.parse(JSON.stringify(pe(f.element)));f.isAction?(n.actionSetting.actionClickValue.componentSetting.userSettingKeyMap=t,_.updateActionElement(n)):n.componentSetting.userSettingKeyMap=t,_.editComponent(n)},U=t=>{f.componentSetting.jumpType===2?window.location.href=t:window.open(t)};return(t,n)=>{const d=m("el-input"),p=m("el-form-item"),V=m("el-radio"),E=m("el-radio-group"),Q=m("el-form"),X=m("easy-dialog");return r(),g("div",{class:"wrapper material-collection",style:k({...q.value,padding:a.componentSetting.padding+"px",fontFamily:a.componentSetting.fontFamily})},[o("div",{class:"keyboard-mode",style:k({maxWidth:a.componentSetting.keyboardMaxWidth+"px"})},[(r(!0),g(Z,null,H(A(F),(i,s)=>(r(),g("div",{class:se(["keys-wrapper",{hidden:i.span}]),key:s,style:k({width:`${i.span?i.span*4.5:9}%`,padding:`${a.componentSetting.keyGutter}px`})},[o("div",{class:"keys-box",onClick:h=>J(h,s),style:k({background:a.componentSetting.keyBackground,borderRadius:a.componentSetting.keyBorderRadius})},[o("div",ke,[o("div",ve,y(s),1),l.value[s]?(r(),g("div",{key:0,class:"edit-icon-box",onClick:R(h=>$(h,s),["stop"])},he,8,Ce)):v("",!0),l.value[s]?v("",!0):(r(),g("div",be,Se)),l.value[s]?(r(),g("div",we,[o("img",{class:"icon",src:l.value[s].icon||A(b)(l.value[s].url),alt:"link",onError:h=>G(h,s)},null,40,Ve),o("div",Ee,y(l.value[s].remark.slice(0,1)),1)])):v("",!0),l.value[s]&&l.value[s].remark?(r(),g("div",Be,y(l.value[s].remark),1)):v("",!0)])],12,me)],6))),128)),o("div",{class:"keys-wrapper",style:k({width:"9.08%",padding:`${a.componentSetting.keyGutter}px`})},[o("div",{class:"keys-box",style:k({background:a.componentSetting.keyBackground,borderRadius:a.componentSetting.keyBorderRadius})},Fe,4)],4)],4),u(X,{modelValue:I.value,"onUpdate:modelValue":n[5]||(n[5]=i=>I.value=i),width:"400px",height:"400px",closeOnClickOutside:"",onClose:S},{footer:c(()=>[o("div",$e,[o("button",{type:"button",class:"btn",disabled:!e.editingInfo.url&&!e.editingInfo.remark,onClick:P},y(t.$t("\u6E05\u7A7A")),9,De),o("button",{type:"button",class:"btn btn-primary",loading:w.value,onClick:j},y(t.$t("\u786E\u8BA4")),9,Me)])]),default:c(()=>[de(o("div",{class:"edit-content",onKeydown:n[4]||(n[4]=R(()=>{},["stop"]))},[o("div",xe,y(e.editingInfo.key),1),u(Q,{ref:"form","label-width":"110px"},{default:c(()=>[u(p,{label:t.$t("\u7F51\u7AD9\u5730\u5740")},{default:c(()=>[u(d,{modelValue:e.editingInfo.url,"onUpdate:modelValue":n[0]||(n[0]=i=>e.editingInfo.url=i),placeholder:t.$t("\u8BF7\u8F93\u5165\u7F51\u7AD9\u5730\u5740"),onBlur:D},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),u(p,{label:t.$t("\u7F51\u7AD9\u540D\u79F0")},{default:c(()=>[u(d,{modelValue:e.editingInfo.remark,"onUpdate:modelValue":n[1]||(n[1]=i=>e.editingInfo.remark=i),placeholder:t.$t("\u8BF7\u8F93\u5165\u7F51\u7AD9\u540D\u79F0")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),u(p,{label:t.$t("\u7F51\u7AD9\u56FE\u6807")},{default:c(()=>[u(E,{modelValue:e.editingInfo.iconType,"onUpdate:modelValue":n[2]||(n[2]=i=>e.editingInfo.iconType=i),onChange:K},{default:c(()=>[(r(),g(Z,null,H(z,i=>u(V,{label:i.value,key:i.value},{default:c(()=>[re(y(t.$t(i.label)),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])]),_:1},8,["label"]),e.editingInfo.iconType==="network"?(r(),ce(p,{key:0,label:t.$t("\u56FE\u6807\u5730\u5740")},{default:c(()=>[u(d,{modelValue:e.editingInfo.iconLink,"onUpdate:modelValue":n[3]||(n[3]=i=>e.editingInfo.iconLink=i),placeholder:t.$t("\u8BF7\u8F93\u5165\u56FE\u6807\u5730\u5740"),onBlur:M},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):v("",!0),u(p,{label:t.$t("\u56FE\u6807\u9884\u89C8")},{default:c(()=>[o("div",Le,[C.value?(r(),g("img",{key:0,src:C.value,alt:"icon-preview"},null,8,Te)):v("",!0)])]),_:1},8,["label"])]),_:1},512)],544),[[ue,e.editingActive]])]),_:1},8,["modelValue"])],4)}}});var Oe=Y(Ke,[["__scopeId","data-v-1c60684c"]]);export{Oe as default};
