import{D as J}from"./vuedraggable.umd.382d0bd4.js";import{g as P}from"./images.6dcbb847.js";import{_ as R,d as O,m as j,r as v,J as X,z as Y,c as z,H,e as h,o as s,k as u,h as a,t as l,i as r,g as d,j as p,U as T,F as V,n as K,f as A,V as M,K as G,v as U,a4 as Q,x as W,y as Z}from"./index.af0aa0c6.js";const x=[{label:"API\u83B7\u53D6",value:"api"},{label:"\u6587\u5B57\u56FE\u6807",value:"text"},{label:"\u7F51\u7EDC\u56FE\u7247",value:"network"}],ee=O({name:"EngineConfig",components:{Draggable:J,Tips:j},props:{engineList:{type:Array,required:!0},backupEngineList:{type:Array,required:!0}},emits:["update"],setup(e,{emit:n}){const $=v(!1),F=v(!1),m=v([]),b=v([]),k=v(""),f=v(!1),{t:y}=X();Y(()=>{m.value=JSON.parse(JSON.stringify(e.engineList)),b.value=JSON.parse(JSON.stringify(e.backupEngineList))});const w=g=>{const{oldIndex:c}=g,{iconType:i}=m.value[c];i!=="local"&&(F.value=!0)},C=async()=>{await M(),F.value=!1},_=g=>{const{originalEvent:c}=g;let i;if(c.type==="touchend"){const{clientX:D,clientY:E}=c.changedTouches[0];i=document.elementFromPoint(D,E)}else{const{clientX:D,clientY:E}=c;i=document.elementFromPoint(D,E)}if((i==null?void 0:i.className)==="delete-area"&&window.confirm(y("\u662F\u5426\u5220\u9664\u8BE5\u81EA\u5B9A\u4E49\u5F15\u64CE"))){const{newIndex:D}=g;m.value.splice(D,1)}n("update",{engineList:m.value,backupEngineList:b.value})},t=z({formData:{_id:"",name:"",link:"",iconType:"api",iconPath:""},formRules:{name:[{required:!0,message:"\u8BF7\u8F93\u5165\u5F15\u64CE\u540D\u79F0",trigger:"blur"}],link:[{required:!0,message:"\u8BF7\u8F93\u5165\u5F15\u64CE\u5730\u5740",trigger:"blur"}],iconType:[{required:!0,message:"\u8BF7\u9009\u62E9\u56FE\u6807\u7C7B\u578B",trigger:"change"}],iconPath:[{validator:B,trigger:"blur"}]}});function B(g,c,i){t.formData.iconType==="network"&&!c?i(new Error("\u8BF7\u8F93\u5165\u56FE\u6807\u5730\u5740")):i()}const o=v(),L=H(()=>t.formData.iconType==="api"&&t.formData.link||t.formData.iconType==="network"&&t.formData.iconPath||t.formData.iconType==="text"&&t.formData.name),S=()=>{t.formData={_id:"",name:"",link:"",iconType:"api",iconPath:""},f.value=!0},I=()=>{o.value.resetFields(),t.formData={_id:"",name:"",link:"",iconType:"api",iconPath:""},f.value=!1};return{engineDialogVisible:f,dragDisabled:$,showDeleteArea:F,cloneEngineList:m,cloneBackupEngineList:b,handleDragChoose:w,handleDragUnchoose:C,handleDragEnd:_,handleAddNewEngine:S,handleEditEngine:g=>{const{_id:c,name:i,link:D,iconType:E,iconPath:q}=g;E!=="local"&&(t.formData={_id:c,name:i,link:D,iconType:E,iconPath:q},f.value=!0)},iconTypeList:x,state:t,form:o,showIconPreview:L,close:I,submit:()=>{o.value.validate(async g=>{if(g){if(t.formData.iconType==="api"&&k.value)try{const i=await(await fetch(`${G}/api/icon?url=${encodeURIComponent(t.formData.link)}&type=link`)).text();i&&(t.formData.iconType="network",t.formData.iconPath=i)}catch{}if(t.formData._id){const c=m.value.findIndex(i=>i._id===t.formData._id);~c&&(m.value[c]={...U(t.formData)})}else t.formData._id=Q(),m.value.push({...U(t.formData)});n("update",{engineList:m.value,backupEngineList:b.value}),I()}else return!1})},getTargetIcon:P,tempIconLink:k,handleLinkInputBlur:()=>{k.value=P(t.formData.link)}}}}),N=e=>(W("data-v-54146fce"),e=e(),Z(),e),oe={class:"engine-config",style:{"margin-left":"-100px","padding-bottom":"10px","border-bottom":"1px solid #ccc"}},ne={class:"warning"},te={class:"content"},ae={class:"text s-title"},ie={class:"current-engine-wrapper"},se=["onDblclick","title"],le=["src"],ue=["src"],re={key:2,class:"no-icon"},de={class:"text"},ce={class:"text s-title"},pe={class:"backup-engine-wrapper"},me={class:"engine-list-item"},ge=["src"],fe=["src"],he={key:2,class:"no-icon"},ye={class:"text"},De={key:0,class:"delete-area"},ve={class:"form-control"},ke={class:"tips"},Ee=N(()=>a("b",null,"[0]",-1)),be={class:"tips"},Fe=N(()=>a("b",null,"https://juejin.im/search?query=[0]&type=all",-1)),_e={class:"icon-img-preview-box"},Te=["src"],we=["src"],Ce={key:2,class:"no-icon"},Be={key:1,class:"icon-img-preview"},Ve={class:"footer",style:{"text-align":"right",padding:"12px"}};function $e(e,n,$,F,m,b){const k=h("Draggable"),f=h("el-input"),y=h("el-form-item"),w=h("Tips"),C=h("el-radio"),_=h("el-radio-group"),t=h("el-form"),B=h("easy-dialog");return s(),u(V,null,[a("div",oe,[a("div",ne,l(e.$t("searchConfigTips")),1),a("div",te,[a("button",{type:"button",class:"btn btn-primary btn-small btn-add",onClick:n[0]||(n[0]=(...o)=>e.handleAddNewEngine&&e.handleAddNewEngine(...o))},l(e.$t("\u6DFB\u52A0")),1),a("div",ae,l(e.$t("\u5F53\u524D\u5F15\u64CE\u7EC4")),1),a("div",ie,[r(k,{modelValue:e.cloneEngineList,"onUpdate:modelValue":n[1]||(n[1]=o=>e.cloneEngineList=o),class:"now-engine-list engine-list","item-key":"name",group:"people",onChoose:e.handleDragChoose,onUnchoose:e.handleDragUnchoose,onEnd:e.handleDragEnd},{item:d(({element:o})=>[a("div",{class:"engine-list-item",onDblclick:L=>e.handleEditEngine(o),title:o.iconType!=="local"?e.$t("\u53CC\u51FB\u91CD\u65B0\u7F16\u8F91"):""},[o.iconType==="local"||o.iconType==="network"?(s(),u("img",{key:0,src:o.iconPath,alt:"icon",width:"24",height:"24"},null,8,le)):p("",!0),o.iconType==="api"?(s(),u("img",{key:1,src:e.getTargetIcon(o.link),alt:"icon",width:"24",height:"24"},null,8,ue)):p("",!0),o.iconType==="text"?(s(),u("div",re,l(o.name.slice(0,1)),1)):p("",!0),a("div",de,l(o.name),1)],40,se)]),_:1},8,["modelValue","onChoose","onUnchoose","onEnd"])]),a("div",ce,l(e.$t("\u5907\u7528\u5F15\u64CE\u7EC4")),1),a("div",pe,[r(k,{modelValue:e.cloneBackupEngineList,"onUpdate:modelValue":n[2]||(n[2]=o=>e.cloneBackupEngineList=o),"item-key":"name",group:"people",class:"backupEngineList engine-list",onEnd:e.handleDragEnd},{item:d(({element:o})=>[a("div",me,[o.iconType==="local"||o.iconType==="network"?(s(),u("img",{key:0,src:o.iconPath,alt:"icon",width:"24",height:"24"},null,8,ge)):p("",!0),o.iconType==="api"?(s(),u("img",{key:1,src:e.getTargetIcon(o.link),alt:"icon",width:"24",height:"24"},null,8,fe)):p("",!0),o.iconType==="text"?(s(),u("div",he,l(o.name.slice(0,1)),1)):p("",!0),a("div",ye,l(o.name),1)])]),_:1},8,["modelValue","onEnd"]),e.showDeleteArea?(s(),u("div",De,l(e.$t("\u62D6\u62FD\u81F3\u6B64\u5904\u5220\u9664")),1)):p("",!0)])])]),r(B,{modelValue:e.engineDialogVisible,"onUpdate:modelValue":n[10]||(n[10]=o=>e.engineDialogVisible=o),title:`${e.state.formData._id?e.$t("\u7F16\u8F91"):e.$t("\u6DFB\u52A0")}${e.$t("\u81EA\u5B9A\u4E49\u5F15\u64CE")}`,width:"min(380px, 90vw)",height:"min(460px, 80vh)",customClass:"add-engine-dialog"},{footer:d(()=>[a("div",Ve,[a("button",{type:"button",class:"btn",onClick:n[8]||(n[8]=(...o)=>e.close&&e.close(...o))},l(e.$t("\u53D6\u6D88")),1),a("button",{type:"button",class:"btn btn-primary",onClick:n[9]||(n[9]=(...o)=>e.submit&&e.submit(...o))},l(e.$t("\u786E\u8BA4")),1)])]),default:d(()=>[r(t,{ref:"form","label-width":"90px",model:e.state.formData,rules:e.state.formRules},{default:d(()=>[r(y,{label:e.$t("\u5F15\u64CE\u540D\u79F0"),prop:"name"},{default:d(()=>[r(f,{modelValue:e.state.formData.name,"onUpdate:modelValue":n[3]||(n[3]=o=>e.state.formData.name=o),placeholder:e.$t("\u8BF7\u8F93\u5165\u5F15\u64CE\u540D\u79F0")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(y,{label:e.$t("\u5F15\u64CE\u5730\u5740"),prop:"link"},{default:d(()=>[a("div",ve,[r(f,{modelValue:e.state.formData.link,"onUpdate:modelValue":n[4]||(n[4]=o=>e.state.formData.link=o),placeholder:e.$t("\u8BF7\u8F93\u5165\u5F15\u64CE\u5730\u5740"),onBlur:e.handleLinkInputBlur},null,8,["modelValue","placeholder","onBlur"]),r(w,null,{default:d(()=>[a("div",ke,[T(l(e.$t("engineConfigTips1"))+" ",1),Ee,T(" "+l(e.$t("engineConfigTips2")),1)]),a("div",be,[T(l(e.$t("\u4F8B\u5982"))+": ",1),Fe])]),_:1})])]),_:1},8,["label"]),r(y,{label:e.$t("\u5F15\u64CE\u56FE\u6807"),prop:"iconType"},{default:d(()=>[r(_,{modelValue:e.state.formData.iconType,"onUpdate:modelValue":n[5]||(n[5]=o=>e.state.formData.iconType=o)},{default:d(()=>[(s(!0),u(V,null,K(e.iconTypeList,o=>(s(),A(C,{label:o.value,key:o.value},{default:d(()=>[T(l(e.$t(o.label)),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),e.state.formData.iconType==="network"?(s(),A(y,{key:0,label:e.$t("\u56FE\u6807\u5730\u5740"),prop:"iconPath"},{default:d(()=>[r(_,{modelValue:e.state.formData.iconType,"onUpdate:modelValue":n[7]||(n[7]=o=>e.state.formData.iconType=o)},{default:d(()=>[r(f,{modelValue:e.state.formData.iconPath,"onUpdate:modelValue":n[6]||(n[6]=o=>e.state.formData.iconPath=o),placeholder:e.$t("\u8BF7\u8F93\u5165\u56FE\u6807\u5730\u5740")},null,8,["modelValue","placeholder"])]),_:1},8,["modelValue"])]),_:1},8,["label"])):p("",!0),r(y,{label:e.$t("\u56FE\u6807\u9884\u89C8")},{default:d(()=>[a("div",_e,[e.showIconPreview?(s(),u(V,{key:0},[e.state.formData.iconType==="network"?(s(),u("img",{key:0,src:e.state.formData.iconPath,alt:"icon",width:"24",height:"24"},null,8,Te)):p("",!0),e.state.formData.iconType==="api"?(s(),u("img",{key:1,src:e.tempIconLink,alt:"icon",width:"24",height:"24"},null,8,we)):p("",!0),e.state.formData.iconType==="text"?(s(),u("div",Ce,l(e.state.formData.name.slice(0,1)),1)):p("",!0)],64)):(s(),u("div",Be))])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])],64)}var Se=R(ee,[["render",$e],["__scopeId","data-v-54146fce"]]);export{Se as default};
