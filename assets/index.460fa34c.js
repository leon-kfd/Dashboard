var J=Object.defineProperty;var B=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var V=(e,t,i)=>t in e?J(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,T=(e,t)=>{for(var i in t||(t={}))Z.call(t,i)&&V(e,i,t[i]);if(B)for(var i of B(t))$.call(t,i)&&V(e,i,t[i]);return e};import{h as H,k as P,i as z,N as W,r as C,o as G,b as Q,e as c,g as n,F as X,v as Y,A as y,s as x,t as N,u as ee,aa as te,m as oe,d as g,z as I,E as S,ad as U,D as f,y as b,af as ne,ae as D,p as ie,f as se}from"./vendor.66f145fe.js";import{_ as ae,m as de,f as re}from"./index.52a495f8.js";import{a as L,b as le}from"./images.94ba6faa.js";const w={tab:{span:1},Q:{keyCode:81},W:{keyCode:87},E:{keyCode:69},R:{keyCode:82},T:{keyCode:84},Y:{keyCode:89},U:{keyCode:85},I:{keyCode:73},O:{keyCode:79},P:{keyCode:80},brackets:{span:1},caps:{span:2},A:{keyCode:65},S:{keyCode:83},D:{keyCode:68},F:{keyCode:70},G:{keyCode:71},H:{keyCode:72},J:{keyCode:74},K:{keyCode:75},L:{keyCode:76},semi:{span:2},shift:{span:3},Z:{keyCode:90},X:{keyCode:88},C:{keyCode:67},V:{keyCode:86},B:{keyCode:66},N:{keyCode:78},M:{keyCode:77}};const ue=H({name:"Collection",props:{componentSetting:{type:Object,required:!0},element:{type:Object,required:!0},isAction:{type:Boolean,default:!1}},setup(e){const t=P(),i=z(()=>e.componentSetting.userSettingKeyMap||{}),M=z(()=>de(e.componentSetting.position)),o=W({editingActive:!1,editingInfo:{key:"",url:"",remark:""}}),m=C(!1),k=s=>{if(!e.componentSetting.useKeyboardEvent||!t.state.isLock||document.querySelector("input:focus")||document.querySelector("textarea:focus")||document.querySelector(".ProseMirror-focused")||document.querySelector(".action-popover"))return;const a=s.keyCode,u=Object.keys(w).find(v=>w[v].keyCode===a);u&&i.value[u]&&E(i.value[u].url)};G(()=>{document.addEventListener("keydown",k)}),Q(()=>{document.removeEventListener("keydown",k)});const d=C(),r=(s,a)=>{a&&i.value[a]?E(i.value[a].url):(d.value.open(s.currentTarget),o.editingInfo.key=a,setTimeout(()=>{o.editingActive=!0,m.value=!0},200))},l=()=>{o.editingInfo.key="",o.editingInfo.url="",o.editingInfo.remark="",o.editingActive=!1},O=(s,a)=>{var _,A;const u=(A=(_=s==null?void 0:s.currentTarget)==null?void 0:_.parentNode)==null?void 0:A.parentNode;d.value.open(u),o.editingInfo.key=a;const{url:v,remark:q}=i.value[a];o.editingInfo.url=v,o.editingInfo.remark=q,setTimeout(()=>{o.editingActive=!0,m.value=!0},200)},R=()=>{if(o.editingInfo.url&&o.editingInfo.remark&&confirm("\u786E\u5B9A\u6E05\u9664\u8BE5\u6309\u952E\u7ED1\u5B9A\u7684\u7F51\u9875\u5417?")){o.editingInfo.url="",o.editingInfo.remark="";const s=ee(i);delete s[o.editingInfo.key],K(s),l(),d.value.close()}},h=C(!1),j=async()=>{if(!(!o.editingInfo.url||!o.editingInfo.remark))if(/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/.test(o.editingInfo.url)){/https?:\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/.test(o.editingInfo.url)||(o.editingInfo.url="https://"+o.editingInfo.url),h.value=!0;let[s,a]=await re(le(L(o.editingInfo.url)));s&&(a=`${new URL(o.editingInfo.url).origin}/favicon.ico`);const u=JSON.parse(JSON.stringify(i.value));u[o.editingInfo.key]={url:o.editingInfo.url,remark:o.editingInfo.remark,icon:a},K(u),setTimeout(()=>{l(),h.value=!1,d.value.close()},400)}else window.alert("URL\u5730\u5740\u4E0D\u6B63\u786E")},F=s=>{const a=s.currentTarget;a.style.visibility="hidden",a.nextElementSibling.style.visibility="inherit"},K=s=>{const a=JSON.parse(JSON.stringify(te(e.element)));e.isAction?(a.actionSetting.actionClickValue.componentSetting.userSettingKeyMap=s,t.dispatch("updateActionElement",a)):a.componentSetting.userSettingKeyMap=s,t.dispatch("editComponent",a)},E=s=>{e.componentSetting.jumpType===2?window.location.href=s:window.open(s)};return{keyboardMap:w,userSettingKeyMap:i,handleKeyClick:r,handleDialogClose:l,showDialog:O,editState:o,clearEidtInfo:R,handleImgError:F,handleUserKeySave:j,saveLoading:h,dialog:d,positionCSS:M,dialogFooterVisible:m,getTargetIconV2:L}}}),p=e=>(ie("data-v-77a10369"),e=e(),se(),e),ce=["onClick"],ge={class:"keys"},pe={class:"keys-name"},ye=["onClick"],fe=p(()=>n("svg",{class:"icon",viewBox:"0 0 1024 1024",width:"14",height:"14"},[n("path",{d:"M231.08266667 509.49688889c-0.11377778 51.76888889-41.87022222 93.52533333-93.75288889 93.41155556-51.65511111-0.11377778-93.63911111-42.09777778-93.52533333-93.86666667 0-51.54133333 42.21155555-93.52533333 93.98044444-93.41155556 51.65511111 0.11377778 93.29777778 41.984 93.29777778 93.86666667z m656.49777778-93.75288889c51.76888889 0 93.86666667 41.87022222 93.86666666 93.52533333 0.11377778 51.65511111-41.87022222 93.75288889-93.63911111 93.75288889-51.88266667 0-93.75288889-41.64266667-93.75288889-93.52533333s41.64266667-93.75288889 93.52533334-93.75288889zM512.45511111 603.02222222c-51.65511111 0-93.98044445-42.43911111-93.75288889-93.75288889 0.34133333-51.76888889 42.21155555-93.52533333 93.98044445-93.52533333 51.65511111 0 93.86666667 42.21155555 93.63911111 93.75288889-0.11377778 51.65511111-42.09777778 93.52533333-93.86666667 93.52533333z"})],-1)),me=[fe],ke={key:1,class:"plus-box"},ve=p(()=>n("svg",{class:"icon",viewBox:"0 0 1024 1024",width:"20",height:"20"},[n("path",{d:"M896 469.333333H554.666667V128a42.666667 42.666667 0 0 0-85.333334 0v341.333333H128a42.666667 42.666667 0 0 0 0 85.333334h341.333333v341.333333a42.666667 42.666667 0 0 0 85.333334 0V554.666667h341.333333a42.666667 42.666667 0 0 0 0-85.333334z"})],-1)),Se=[ve],he={key:2,class:"icon-box"},Ce=["src"],Ie={class:"no-icon",style:{visibility:"hidden"}},be={key:3,class:"mark-text"},we={class:"keys-wrapper",style:{width:"9.08%"}},Me=p(()=>n("div",{class:"keys"},null,-1)),Ke=[Me],Ee={class:"editing-key"},_e=p(()=>n("div",{class:"label"},"URL",-1)),Ae=p(()=>n("div",{class:"line"},null,-1)),Be=p(()=>n("div",{class:"label"},"Remark",-1)),Ve=p(()=>n("div",{class:"line"},null,-1)),Te={key:0,class:"footer",style:{"text-align":"right",padding:"12px"}},ze=["disabled"],Ne=["loading"];function Ue(e,t,i,M,o,m){const k=oe("animation-dialog");return g(),c("div",{class:"wrapper",style:y(T({},e.positionCSS))},[n("div",{class:"keyboard-mode",style:y({maxWidth:e.componentSetting.keyboardMaxWidth+"px"})},[(g(!0),c(X,null,Y(e.keyboardMap,(d,r)=>(g(),c("div",{class:I(["keys-wrapper",{hidden:d.span}]),key:r,style:y({width:`${d.span?d.span*4.5:9}%`,padding:`${e.componentSetting.keyGutter}px`})},[n("div",{class:"keys-box",onClick:l=>e.handleKeyClick(l,r),style:y({background:e.componentSetting.keyBackground,borderRadius:e.componentSetting.keyBorderRadius})},[n("div",ge,[n("div",pe,S(r),1),e.userSettingKeyMap[r]?(g(),c("div",{key:0,class:"edit-icon-box",onClick:U(l=>e.showDialog(l,r),["stop"])},me,8,ye)):f("",!0),e.userSettingKeyMap[r]?f("",!0):(g(),c("div",ke,Se)),e.userSettingKeyMap[r]?(g(),c("div",he,[n("img",{class:"icon",src:e.userSettingKeyMap[r].icon||e.getTargetIconV2(e.userSettingKeyMap[r].url),alt:"link",onError:t[0]||(t[0]=(...l)=>e.handleImgError&&e.handleImgError(...l))},null,40,Ce),n("div",Ie,S(e.userSettingKeyMap[r].remark.slice(0,1)),1)])):f("",!0),e.userSettingKeyMap[r]&&e.userSettingKeyMap[r].remark?(g(),c("div",be,S(e.userSettingKeyMap[r].remark),1)):f("",!0)])],12,ce)],6))),128)),n("div",we,[n("div",{class:"keys-box",style:y({background:e.componentSetting.keyBackground,borderRadius:e.componentSetting.keyBorderRadius})},Ke,4)])],4),x(k,{ref:"dialog",width:"300px",height:"330px",appendToBody:"",closeOnClickOutside:!1,onBeforeClose:t[6]||(t[6]=d=>e.dialogFooterVisible=!1),onClose:e.handleDialogClose},{footer:N(()=>[e.dialogFooterVisible?(g(),c("div",Te,[n("button",{type:"button",class:"btn",disabled:!e.editState.editingInfo.url&&!e.editState.editingInfo.remark,onClick:t[4]||(t[4]=(...d)=>e.clearEidtInfo&&e.clearEidtInfo(...d))},"\u6E05\u7A7A",8,ze),n("button",{type:"button",class:"btn btn-primary",loading:e.saveLoading,onClick:t[5]||(t[5]=(...d)=>e.handleUserKeySave&&e.handleUserKeySave(...d))},"\u786E\u8BA4",8,Ne)])):f("",!0)]),default:N(()=>[b(n("div",{class:"edit-content",onKeydown:t[3]||(t[3]=U(()=>{},["stop"]))},[n("div",Ee,S(e.editState.editingInfo.key),1),n("div",{class:I(["row-input",{active:e.editState.editingInfo.url.length>0}])},[b(n("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=d=>e.editState.editingInfo.url=d)},null,512),[[D,e.editState.editingInfo.url]]),_e,Ae],2),n("div",{class:I(["row-input",{active:e.editState.editingInfo.remark.length>0}])},[b(n("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=d=>e.editState.editingInfo.remark=d)},null,512),[[D,e.editState.editingInfo.remark]]),Be,Ve],2)],544),[[ne,e.editState.editingActive]])]),_:1},8,["onClose"])],4)}var je=ae(ue,[["render",Ue],["__scopeId","data-v-77a10369"]]);export{je as default};
