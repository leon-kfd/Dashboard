import{_ as se,d as ue,u as de,H as Z,I as re,X as z,J as ce,c as pe,r as _,z as me,A as fe,Y as R,Z as H,e as k,o as r,k as c,h as i,F as j,n as q,C as ge,D as v,P as J,t as y,O as P,j as C,p as S,i as d,g as p,R as ye,U as ke,f as ve,v as Ce,x as Ie,y as he}from"./index.af0aa0c6.js";import{a as w,b as be}from"./images.6dcbb847.js";import{I as _e}from"./IframeOpener.9a23c021.js";import"./ActionPopover.fe6e576b.js";import"./direction.52659f5b.js";const M={tab:{span:1},Q:{keyCode:81},W:{keyCode:87},E:{keyCode:69},R:{keyCode:82},T:{keyCode:84},Y:{keyCode:89},U:{keyCode:85},I:{keyCode:73},O:{keyCode:79},P:{keyCode:80},brackets:{span:1},caps:{span:2},A:{keyCode:65},S:{keyCode:83},D:{keyCode:68},F:{keyCode:70},G:{keyCode:71},H:{keyCode:72},J:{keyCode:74},K:{keyCode:75},L:{keyCode:76},semi:{span:2},shift:{span:3},Z:{keyCode:90},X:{keyCode:88},C:{keyCode:67},V:{keyCode:86},B:{keyCode:66},N:{keyCode:78},M:{keyCode:77}};const D=s=>(Ie("data-v-cd899838"),s=s(),he(),s),Se=["onClick"],we={class:"keys"},Ee={class:"keys-name"},Be=["onClick"],Fe=D(()=>i("svg",{viewBox:"0 0 24 24",width:"12",height:"12"},[i("path",{d:"M4.5 10.5C3.675 10.5 3 11.175 3 12C3 12.825 3.675 13.5 4.5 13.5C5.325 13.5 6 12.825 6 12C6 11.175 5.325 10.5 4.5 10.5ZM19.5 10.5C18.675 10.5 18 11.175 18 12C18 12.825 18.675 13.5 19.5 13.5C20.325 13.5 21 12.825 21 12C21 11.175 20.325 10.5 19.5 10.5ZM12 10.5C11.175 10.5 10.5 11.175 10.5 12C10.5 12.825 11.175 13.5 12 13.5C12.825 13.5 13.5 12.825 13.5 12C13.5 11.175 12.825 10.5 12 10.5Z"})],-1)),Ae=[Fe],Ve={key:1,class:"plus-box"},Te=D(()=>i("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[i("path",{d:"M11 11V5H13V11H19V13H13V19H11V13H5V11H11Z"})],-1)),Le=[Te],xe={key:2,class:"icon-box"},Me=["src","onError"],De={class:"no-icon",style:{visibility:"hidden"}},$e={key:3,class:"mark-text"},Ke=D(()=>i("div",{class:"keys"},null,-1)),Oe=[Ke],Ue={class:"editing-key"},Ne={class:"icon-img-preview-box"},Ze=["src"],ze={class:"footer",style:{"text-align":"right",padding:"12px"}},Re=["disabled"],He=["loading"],je=ue({__name:"index",props:{componentSetting:{type:Object,required:!0},element:{type:Object,required:!0},isAction:{type:Boolean,default:!1}},setup(s){const f=s,E=de(),t=Z(()=>f.componentSetting.userSettingKeyMap||{}),G=Z(()=>re(f.componentSetting.position)),W={...z,updated:z.mounted},{t:g}=ce(),X=[{label:"API\u83B7\u53D6",value:"api"},{label:"\u7F51\u7EDC\u56FE\u7247",value:"network"}],e=pe({editingActive:!1,editingInfo:{key:"",url:"",remark:"",iconType:"api",iconLink:""}}),B=_(),I=_(""),$=n=>{if(!f.componentSetting.useKeyboardEvent||!E.isLock||document.querySelector("input:focus")||document.querySelector("textarea:focus")||document.querySelector(".ProseMirror-focused")||document.querySelector(".action-popover"))return;const o=n.keyCode,u=Object.keys(M).find(m=>M[m].keyCode===o);u&&t.value[u]&&N(t.value[u].url)};me(()=>{document.addEventListener("keydown",$)}),fe(()=>{document.removeEventListener("keydown",$)});const h=_(!1),Y=(n,o)=>{o&&t.value[o]?N(t.value[o].url):A(n,o)},F=()=>{e.editingInfo.key="",e.editingInfo.url="",e.editingInfo.remark="",e.editingInfo.iconType="api",e.editingInfo.iconLink="",e.editingActive=!1},A=(n,o)=>{h.value=!0,e.editingInfo.key=o;const{url:u,remark:m,iconType:L,iconLink:x}=t.value[o]||{};e.editingInfo.url=u,e.editingInfo.remark=m,e.editingInfo.iconType=L||"api",e.editingInfo.iconLink=x,U(),setTimeout(()=>{e.editingActive=!0},200)},Q=()=>{if(e.editingInfo.url&&e.editingInfo.remark&&confirm(g("\u786E\u5B9A\u6E05\u9664\u8BE5\u6309\u952E\u7ED1\u5B9A\u7684\u7F51\u9875\u5417?"))){e.editingInfo.url="",e.editingInfo.remark="";const n=S(t);delete n[e.editingInfo.key],T(n),F(),h.value=!1}},ee=n=>{if(confirm(g("\u786E\u5B9A\u6E05\u9664\u8BE5\u6309\u952E\u7ED1\u5B9A\u7684\u7F51\u9875\u5417?"))){const o=S(t);delete o[n],T(o)}},K=()=>{e.editingInfo.url&&e.editingInfo.iconType==="api"&&(I.value=w(e.editingInfo.url))},O=()=>{e.editingInfo.url&&e.editingInfo.iconType==="network"&&(I.value=e.editingInfo.iconLink)},U=()=>{I.value="",K(),O()},V=_(!1),ne=async()=>{if(!(!e.editingInfo.url||!e.editingInfo.remark))if(/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/.test(e.editingInfo.url)){/https?:\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/.test(e.editingInfo.url)||(e.editingInfo.url="https://"+e.editingInfo.url),V.value=!0;let n="";if(e.editingInfo.iconType==="network")n=e.editingInfo.iconLink;else{try{n=await be(w(e.editingInfo.url))}catch{n=w(e.editingInfo.url)}e.editingInfo.iconType="api"}const o=JSON.parse(JSON.stringify(t.value));o[e.editingInfo.key]={url:e.editingInfo.url,remark:e.editingInfo.remark,icon:n,iconType:e.editingInfo.iconType,iconLink:e.editingInfo.iconLink},T(o),te(e.editingInfo.key),setTimeout(()=>{F(),V.value=!1,h.value=!1},400)}else window.alert(g("URL\u5730\u5740\u4E0D\u6B63\u786E"))},oe=(n,o)=>{const u=n.currentTarget;u.classList.add(`has-error-${o}`),u.style.visibility="hidden",u.nextElementSibling.style.visibility="inherit"},te=n=>{const o=document.querySelector(`.material-collection img.has-error-${n}`);o&&(o.classList.remove(`has-error-${n}`),o.style.visibility="visible",o.nextElementSibling.style.visibility="hidden")},T=n=>{const o=JSON.parse(JSON.stringify(Ce(f.element)));f.isAction?(o.actionSetting.actionClickValue.componentSetting.userSettingKeyMap=n,E.updateActionElement(o)):o.componentSetting.userSettingKeyMap=n,E.editComponent(o)},N=n=>{f.componentSetting.jumpType===3?B.value.open(n):f.componentSetting.jumpType===2?window.location.href=n:window.open(n)},ie=_([{label:n=>t.value[n.key].remark,customClass:"title"},{label:()=>g("\u65B0\u6807\u7B7E\u9875\u6253\u5F00"),customClass:"skip-icon",fn:n=>{window.open(t.value[n.key].url)}},{label:()=>g("IFrame\u7A97\u53E3\u6253\u5F00"),customClass:"skip-icon",fn:n=>{B.value.open(t.value[n.key].url)}},{line:!0},{label:()=>g("\u7F16\u8F91"),icon:R(H,{name:"lock",size:18}),fn:n=>{A(null,n.key)}},{label:()=>g("\u6E05\u7A7A"),icon:R(H,{name:"delete",size:18}),fn:n=>{ee(n.key)},customClass:"delete"}]);return(n,o)=>{const u=k("el-input"),m=k("el-form-item"),L=k("el-radio"),x=k("el-radio-group"),le=k("el-form"),ae=k("easy-dialog");return r(),c("div",{class:"wrapper material-collection",style:v({...G.value,padding:s.componentSetting.padding+"px",fontFamily:s.componentSetting.fontFamily})},[i("div",{class:"keyboard-mode",style:v({maxWidth:s.componentSetting.keyboardMaxWidth+"px"})},[(r(!0),c(j,null,q(S(M),(l,a)=>(r(),c("div",{class:ge(["keys-wrapper",{hidden:l.span}]),key:a,style:v({width:`${l.span?l.span*4.5:9}%`,padding:`${s.componentSetting.keyGutter}px`})},[J((r(),c("div",{class:"keys-box",onClick:b=>Y(b,a),style:v({background:s.componentSetting.keyBackground,borderRadius:s.componentSetting.keyBorderRadius})},[i("div",we,[i("div",Ee,y(a),1),t.value[a]?(r(),c("div",{key:0,class:"edit-icon-box",onClick:P(b=>A(b,a),["stop"])},Ae,8,Be)):C("",!0),t.value[a]?C("",!0):(r(),c("div",Ve,Le)),t.value[a]?(r(),c("div",xe,[i("img",{class:"icon",src:t.value[a].icon||S(w)(t.value[a].url),alt:"link",onError:b=>oe(b,a)},null,40,Me),i("div",De,y(t.value[a].remark.slice(0,1)),1)])):C("",!0),t.value[a]&&t.value[a].remark?(r(),c("div",$e,y(t.value[a].remark),1)):C("",!0)])],12,Se)),[[W,{disabled:()=>!t.value[a],params:{key:a},menuList:ie.value,width:160,iconType:"vnode-icon"}]])],6))),128)),i("div",{class:"keys-wrapper",style:v({width:"9.08%",padding:`${s.componentSetting.keyGutter}px`})},[i("div",{class:"keys-box",style:v({background:s.componentSetting.keyBackground,borderRadius:s.componentSetting.keyBorderRadius})},Oe,4)],4)],4),d(ae,{modelValue:h.value,"onUpdate:modelValue":o[5]||(o[5]=l=>h.value=l),width:"400px",height:"400px",closeOnClickOutside:"",onClose:F},{footer:p(()=>[i("div",ze,[i("button",{type:"button",class:"btn",disabled:!e.editingInfo.url&&!e.editingInfo.remark,onClick:Q},y(n.$t("\u6E05\u7A7A")),9,Re),i("button",{type:"button",class:"btn btn-primary",loading:V.value,onClick:ne},y(n.$t("\u786E\u8BA4")),9,He)])]),default:p(()=>[J(i("div",{class:"edit-content",onKeydown:o[4]||(o[4]=P(()=>{},["stop"]))},[i("div",Ue,y(e.editingInfo.key),1),d(le,{ref:"form","label-width":"110px"},{default:p(()=>[d(m,{label:n.$t("\u7F51\u7AD9\u5730\u5740")},{default:p(()=>[d(u,{modelValue:e.editingInfo.url,"onUpdate:modelValue":o[0]||(o[0]=l=>e.editingInfo.url=l),placeholder:n.$t("\u8BF7\u8F93\u5165\u7F51\u7AD9\u5730\u5740"),onBlur:K},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),d(m,{label:n.$t("\u7F51\u7AD9\u540D\u79F0")},{default:p(()=>[d(u,{modelValue:e.editingInfo.remark,"onUpdate:modelValue":o[1]||(o[1]=l=>e.editingInfo.remark=l),placeholder:n.$t("\u8BF7\u8F93\u5165\u7F51\u7AD9\u540D\u79F0")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),d(m,{label:n.$t("\u7F51\u7AD9\u56FE\u6807")},{default:p(()=>[d(x,{modelValue:e.editingInfo.iconType,"onUpdate:modelValue":o[2]||(o[2]=l=>e.editingInfo.iconType=l),onChange:U},{default:p(()=>[(r(),c(j,null,q(X,l=>d(L,{label:l.value,key:l.value},{default:p(()=>[ke(y(n.$t(l.label)),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])]),_:1},8,["label"]),e.editingInfo.iconType==="network"?(r(),ve(m,{key:0,label:n.$t("\u56FE\u6807\u5730\u5740")},{default:p(()=>[d(u,{modelValue:e.editingInfo.iconLink,"onUpdate:modelValue":o[3]||(o[3]=l=>e.editingInfo.iconLink=l),placeholder:n.$t("\u8BF7\u8F93\u5165\u56FE\u6807\u5730\u5740"),onBlur:O},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):C("",!0),d(m,{label:n.$t("\u56FE\u6807\u9884\u89C8")},{default:p(()=>[i("div",Ne,[I.value?(r(),c("img",{key:0,src:I.value,alt:"icon-preview"},null,8,Ze)):C("",!0)])]),_:1},8,["label"])]),_:1},512)],544),[[ye,e.editingActive]])]),_:1},8,["modelValue"]),d(_e,{ref_key:"iframeOpener",ref:B},null,512)],4)}}});var Xe=se(je,[["__scopeId","data-v-cd899838"]]);export{Xe as default};
