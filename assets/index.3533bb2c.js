import{_ as Y,d as ee,u as ne,G as O,H as oe,I as te,a as ie,r as B,x as le,y as ae,b as m,o as r,i as g,f as t,F as Z,k as H,A as se,C as h,t as f,L as R,h as k,l as A,g as u,e as c,N as de,P as ue,Q as re,c as ce,p as pe,s as ge,v as fe}from"./index.8a015512.js";import{a as _,b as ye}from"./images.a8e9733f.js";const F={tab:{span:1},Q:{keyCode:81},W:{keyCode:87},E:{keyCode:69},R:{keyCode:82},T:{keyCode:84},Y:{keyCode:89},U:{keyCode:85},I:{keyCode:73},O:{keyCode:79},P:{keyCode:80},brackets:{span:1},caps:{span:2},A:{keyCode:65},S:{keyCode:83},D:{keyCode:68},F:{keyCode:70},G:{keyCode:71},H:{keyCode:72},J:{keyCode:74},K:{keyCode:75},L:{keyCode:76},semi:{span:2},shift:{span:3},Z:{keyCode:90},X:{keyCode:88},C:{keyCode:67},V:{keyCode:86},B:{keyCode:66},N:{keyCode:78},M:{keyCode:77}};const L=s=>(ge("data-v-0e5ed500"),s=s(),fe(),s),me=["onClick"],ke={class:"keys"},ve={class:"keys-name"},Ce=["onClick"],Ie=L(()=>t("svg",{viewBox:"0 0 24 24",width:"12",height:"12"},[t("path",{d:"M4.5 10.5C3.675 10.5 3 11.175 3 12C3 12.825 3.675 13.5 4.5 13.5C5.325 13.5 6 12.825 6 12C6 11.175 5.325 10.5 4.5 10.5ZM19.5 10.5C18.675 10.5 18 11.175 18 12C18 12.825 18.675 13.5 19.5 13.5C20.325 13.5 21 12.825 21 12C21 11.175 20.325 10.5 19.5 10.5ZM12 10.5C11.175 10.5 10.5 11.175 10.5 12C10.5 12.825 11.175 13.5 12 13.5C12.825 13.5 13.5 12.825 13.5 12C13.5 11.175 12.825 10.5 12 10.5Z"})],-1)),he=[Ie],_e={key:1,class:"plus-box"},be=L(()=>t("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[t("path",{d:"M11 11V5H13V11H19V13H13V19H11V13H5V11H11Z"})],-1)),Se=[be],we={key:2,class:"icon-box"},Ve=["src","onError"],Ee={class:"no-icon",style:{visibility:"hidden"}},Be={key:3,class:"mark-text"},Ae={class:"keys-wrapper",style:{width:"9.08%"}},Fe=L(()=>t("div",{class:"keys"},null,-1)),Le=[Fe],Te={class:"editing-key"},xe={class:"icon-img-preview-box"},$e=["src"],De={class:"footer",style:{"text-align":"right",padding:"12px"}},Me=["disabled"],Ke=["loading"],Ne=ee({__name:"index",props:{componentSetting:{type:Object,required:!0},element:{type:Object,required:!0},isAction:{type:Boolean,default:!1}},setup(s){const y=s,b=ne(),l=O(()=>y.componentSetting.userSettingKeyMap||{}),q=O(()=>oe(y.componentSetting.position)),{t:T}=te(),z=[{label:"API\u83B7\u53D6",value:"api"},{label:"\u7F51\u7EDC\u56FE\u7247",value:"network"}],e=ie({editingActive:!1,editingInfo:{key:"",url:"",remark:"",iconType:"api",iconLink:""}}),v=B(""),x=o=>{if(!y.componentSetting.useKeyboardEvent||!b.isLock||document.querySelector("input:focus")||document.querySelector("textarea:focus")||document.querySelector(".ProseMirror-focused")||document.querySelector(".action-popover"))return;const n=o.keyCode,d=Object.keys(F).find(p=>F[p].keyCode===n);d&&l.value[d]&&U(l.value[d].url)};le(()=>{document.addEventListener("keydown",x)}),ae(()=>{document.removeEventListener("keydown",x)});const C=B(!1),J=(o,n)=>{n&&l.value[n]?U(l.value[n].url):$(o,n)},S=()=>{e.editingInfo.key="",e.editingInfo.url="",e.editingInfo.remark="",e.editingInfo.iconType="api",e.editingInfo.iconLink="",e.editingActive=!1},$=(o,n)=>{C.value=!0,e.editingInfo.key=n;const{url:d,remark:p,iconType:V,iconLink:E}=l.value[n]||{};e.editingInfo.url=d,e.editingInfo.remark=p,e.editingInfo.iconType=V||"api",e.editingInfo.iconLink=E,K(),setTimeout(()=>{e.editingActive=!0},200)},P=()=>{if(e.editingInfo.url&&e.editingInfo.remark&&confirm(T("\u786E\u5B9A\u6E05\u9664\u8BE5\u6309\u952E\u7ED1\u5B9A\u7684\u7F51\u9875\u5417?"))){e.editingInfo.url="",e.editingInfo.remark="";const o=A(l);delete o[e.editingInfo.key],N(o),S(),C.value=!1}},D=()=>{e.editingInfo.url&&e.editingInfo.iconType==="api"&&(v.value=_(e.editingInfo.url))},M=()=>{e.editingInfo.url&&e.editingInfo.iconType==="network"&&(v.value=e.editingInfo.iconLink)},K=()=>{v.value="",D(),M()},w=B(!1),j=async()=>{if(!(!e.editingInfo.url||!e.editingInfo.remark))if(/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/.test(e.editingInfo.url)){/https?:\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/.test(e.editingInfo.url)||(e.editingInfo.url="https://"+e.editingInfo.url),w.value=!0;let o="";if(e.editingInfo.iconType==="network")o=e.editingInfo.iconLink;else{try{o=await ye(_(e.editingInfo.url))}catch{o=_(e.editingInfo.url)}e.editingInfo.iconType="api"}const n=JSON.parse(JSON.stringify(l.value));n[e.editingInfo.key]={url:e.editingInfo.url,remark:e.editingInfo.remark,icon:o,iconType:e.editingInfo.iconType,iconLink:e.editingInfo.iconLink},N(n),W(e.editingInfo.key),setTimeout(()=>{S(),w.value=!1,C.value=!1},400)}else window.alert(T("URL\u5730\u5740\u4E0D\u6B63\u786E"))},G=(o,n)=>{const d=o.currentTarget;d.classList.add(`has-error-${n}`),d.style.visibility="hidden",d.nextElementSibling.style.visibility="inherit"},W=o=>{const n=document.querySelector(`.material-collection img.has-error-${o}`);n&&(n.classList.remove(`has-error-${o}`),n.style.visibility="visible",n.nextElementSibling.style.visibility="hidden")},N=o=>{const n=JSON.parse(JSON.stringify(pe(y.element)));y.isAction?(n.actionSetting.actionClickValue.componentSetting.userSettingKeyMap=o,b.updateActionElement(n)):n.componentSetting.userSettingKeyMap=o,b.editComponent(n)},U=o=>{y.componentSetting.jumpType===2?window.location.href=o:window.open(o)};return(o,n)=>{const d=m("el-input"),p=m("el-form-item"),V=m("el-radio"),E=m("el-radio-group"),Q=m("el-form"),X=m("easy-dialog");return r(),g("div",{class:"wrapper material-collection",style:h({...q.value,padding:s.componentSetting.padding+"px",fontFamily:s.componentSetting.fontFamily})},[t("div",{class:"keyboard-mode",style:h({maxWidth:s.componentSetting.keyboardMaxWidth+"px"})},[(r(!0),g(Z,null,H(A(F),(i,a)=>(r(),g("div",{class:se(["keys-wrapper",{hidden:i.span}]),key:a,style:h({width:`${i.span?i.span*4.5:9}%`,padding:`${s.componentSetting.keyGutter}px`})},[t("div",{class:"keys-box",onClick:I=>J(I,a),style:h({background:s.componentSetting.keyBackground,borderRadius:s.componentSetting.keyBorderRadius})},[t("div",ke,[t("div",ve,f(a),1),l.value[a]?(r(),g("div",{key:0,class:"edit-icon-box",onClick:R(I=>$(I,a),["stop"])},he,8,Ce)):k("",!0),l.value[a]?k("",!0):(r(),g("div",_e,Se)),l.value[a]?(r(),g("div",we,[t("img",{class:"icon",src:l.value[a].icon||A(_)(l.value[a].url),alt:"link",onError:I=>G(I,a)},null,40,Ve),t("div",Ee,f(l.value[a].remark.slice(0,1)),1)])):k("",!0),l.value[a]&&l.value[a].remark?(r(),g("div",Be,f(l.value[a].remark),1)):k("",!0)])],12,me)],6))),128)),t("div",Ae,[t("div",{class:"keys-box",style:h({background:s.componentSetting.keyBackground,borderRadius:s.componentSetting.keyBorderRadius})},Le,4)])],4),u(X,{modelValue:C.value,"onUpdate:modelValue":n[5]||(n[5]=i=>C.value=i),width:"400px",height:"400px",closeOnClickOutside:"",onClose:S},{footer:c(()=>[t("div",De,[t("button",{type:"button",class:"btn",disabled:!e.editingInfo.url&&!e.editingInfo.remark,onClick:P},f(o.$t("\u6E05\u7A7A")),9,Me),t("button",{type:"button",class:"btn btn-primary",loading:w.value,onClick:j},f(o.$t("\u786E\u8BA4")),9,Ke)])]),default:c(()=>[de(t("div",{class:"edit-content",onKeydown:n[4]||(n[4]=R(()=>{},["stop"]))},[t("div",Te,f(e.editingInfo.key),1),u(Q,{ref:"form","label-width":"110px"},{default:c(()=>[u(p,{label:o.$t("\u7F51\u7AD9\u5730\u5740")},{default:c(()=>[u(d,{modelValue:e.editingInfo.url,"onUpdate:modelValue":n[0]||(n[0]=i=>e.editingInfo.url=i),placeholder:o.$t("\u8BF7\u8F93\u5165\u7F51\u7AD9\u5730\u5740"),onBlur:D},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),u(p,{label:o.$t("\u7F51\u7AD9\u540D\u79F0")},{default:c(()=>[u(d,{modelValue:e.editingInfo.remark,"onUpdate:modelValue":n[1]||(n[1]=i=>e.editingInfo.remark=i),placeholder:o.$t("\u8BF7\u8F93\u5165\u7F51\u7AD9\u540D\u79F0")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),u(p,{label:o.$t("\u7F51\u7AD9\u56FE\u6807")},{default:c(()=>[u(E,{modelValue:e.editingInfo.iconType,"onUpdate:modelValue":n[2]||(n[2]=i=>e.editingInfo.iconType=i),onChange:K},{default:c(()=>[(r(),g(Z,null,H(z,i=>u(V,{label:i.value,key:i.value},{default:c(()=>[re(f(o.$t(i.label)),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])]),_:1},8,["label"]),e.editingInfo.iconType==="network"?(r(),ce(p,{key:0,label:o.$t("\u56FE\u6807\u5730\u5740")},{default:c(()=>[u(d,{modelValue:e.editingInfo.iconLink,"onUpdate:modelValue":n[3]||(n[3]=i=>e.editingInfo.iconLink=i),placeholder:o.$t("\u8BF7\u8F93\u5165\u56FE\u6807\u5730\u5740"),onBlur:M},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):k("",!0),u(p,{label:o.$t("\u56FE\u6807\u9884\u89C8")},{default:c(()=>[t("div",xe,[v.value?(r(),g("img",{key:0,src:v.value,alt:"icon-preview"},null,8,$e)):k("",!0)])]),_:1},8,["label"])]),_:1},512)],544),[[ue,e.editingActive]])]),_:1},8,["modelValue"])],4)}}});var Ze=Y(Ne,[["__scopeId","data-v-0e5ed500"]]);export{Ze as default};
